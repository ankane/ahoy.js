/*! Ahoy.js v0.4.0 | MIT License */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ahoy=t()}(this,(function(){"use strict";var e=function(e,t,n,i){var r="",o="";if(n){var a=new Date;a.setTime(a.getTime()+60*n*1e3),r="; expires="+a.toGMTString()}i&&(o="; domain="+i),document.cookie=e+"="+escape(t)+r+o+"; path=/; samesite=lax"},t=function(e){var t,n,i=e+"=",r=document.cookie.split(";");for(t=0;t<r.length;t++){for(n=r[t];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(i))return unescape(n.substring(i.length,n.length))}return null},n={urlPrefix:"",visitsUrl:"/ahoy/visits",eventsUrl:"/ahoy/events",page:null,platform:"Web",useBeacon:!0,startOnReady:!0,trackVisits:!0,cookies:!0,cookieDomain:null,headers:{},visitParams:{},withCredentials:!1,visitDuration:240,visitorDuration:1051200},i=window.ahoy||window.Ahoy||{};i.configure=function(e){for(var t in e)e.hasOwnProperty(t)&&(n[t]=e[t])},i.configure(i);var r,o,a,s,c=window.jQuery||window.Zepto||window.$,u=!1,d=[],f="undefined"!=typeof JSON&&void 0!==JSON.stringify,l=[];function h(){return n.urlPrefix+n.eventsUrl}function v(){return(n.useBeacon||n.trackNow)&&(e=n.headers,0===Object.keys(e).length)&&f&&void 0!==window.navigator.sendBeacon&&!n.withCredentials;var e}function g(t,i,r){e(t,i,r,n.cookieDomain||n.domain)}function m(e){return n.cookieDomain?t(e,{domain:n.cookieDomain}):t(e)}function y(t){e(t,"",-1)}function p(e){m("ahoy_debug")&&window.console.log(e)}function w(){for(var e;e=d.shift();)e();u=!0}function k(e,t){var n=e.matches||e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector;return n?n.apply(e,[t])?e:e.parentElement?k(e.parentElement,t):null:(p("Unable to match"),null)}function x(e,t,n){document.addEventListener(e,(function(e){var i=k(e.target,t);i&&n.call(i,e)}))}function _(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function b(){n.cookies&&f&&g("ahoy_events",JSON.stringify(l),1)}function S(){var e=document.querySelector("meta[name=csrf-token]");return e&&e.content}function O(e){var t=S();t&&e.setRequestHeader("X-CSRF-Token",t)}function T(e,t,i){if(f)if(c&&c.ajax)c.ajax({type:"POST",url:e,data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",beforeSend:O,success:i,headers:n.headers,xhrFields:{withCredentials:n.withCredentials}});else{var r=new XMLHttpRequest;for(var o in r.open("POST",e,!0),r.withCredentials=n.withCredentials,r.setRequestHeader("Content-Type","application/json"),n.headers)n.headers.hasOwnProperty(o)&&r.setRequestHeader(o,n.headers[o]);r.onload=function(){200===r.status&&i()},O(r),r.send(JSON.stringify(t))}}function C(e){var t={events:[e]};return n.cookies&&(t.visit_token=e.visit_token,t.visitor_token=e.visitor_token),delete e.visit_token,delete e.visitor_token,t}function P(e){i.ready((function(){T(h(),C(e),(function(){for(var t=0;t<l.length;t++)if(l[t].id==e.id){l.splice(t,1);break}b()}))}))}function V(e){i.ready((function(){var t,n=C(e),i=(t=document.querySelector("meta[name=csrf-param]"))&&t.content,r=S();i&&r&&(n[i]=r),n.events_json=JSON.stringify(n.events),delete n.events,window.navigator.sendBeacon(h(),function(e){var t=new FormData;for(var n in e)e.hasOwnProperty(n)&&t.append(n,e[n]);return t}(n))}))}function D(){return n.page||window.location.pathname}function M(e){return e&&e.length>0?e:null}function j(){return function(e){for(var t in e)e.hasOwnProperty(t)&&null===e[t]&&delete e[t];return e}({tag:this.tagName.toLowerCase(),id:M(this.id),class:M(this.className),page:D(),section:N(this)})}function N(e){for(;e&&e!==document;e=e.parentNode)if(e.hasAttribute("data-section"))return e.getAttribute("data-section");return null}function E(){if(u=!1,r=i.getVisitId(),o=i.getVisitorId(),a=m("ahoy_track"),!1===n.cookies||!1===n.trackVisits)p("Visit tracking disabled"),w();else if(r&&o&&!a)p("Active visit"),w();else if(r||g("ahoy_visit",r=_(),n.visitDuration),m("ahoy_visit")){p("Visit started"),o||g("ahoy_visitor",o=_(),n.visitorDuration);var e={visit_token:r,visitor_token:o,platform:n.platform,landing_page:window.location.href,screen_width:window.screen.width,screen_height:window.screen.height,js:!0};for(var t in document.referrer.length>0&&(e.referrer=document.referrer),n.visitParams)n.visitParams.hasOwnProperty(t)&&(e[t]=n.visitParams[t]);p(e),T(n.urlPrefix+n.visitsUrl,e,(function(){y("ahoy_track"),w()}))}else p("Cookies disabled"),w()}i.ready=function(e){u?e():d.push(e)},i.getVisitId=i.getVisitToken=function(){return m("ahoy_visit")},i.getVisitorId=i.getVisitorToken=function(){return m("ahoy_visitor")},i.reset=function(){return y("ahoy_visit"),y("ahoy_visitor"),y("ahoy_events"),y("ahoy_track"),!0},i.debug=function(e){return!1===e?y("ahoy_debug"):g("ahoy_debug","t",525600),!0},i.track=function(e,t){var r={name:e,properties:t||{},time:(new Date).getTime()/1e3,id:_(),js:!0};return i.ready((function(){n.cookies&&!i.getVisitId()&&E(),i.ready((function(){p(r),r.visit_token=i.getVisitId(),r.visitor_token=i.getVisitorId(),v()?V(r):(l.push(r),b(),setTimeout((function(){P(r)}),1e3))}))})),!0},i.trackView=function(e){var t={url:window.location.href,title:document.title,page:D()};if(e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.track("$view",t)},i.trackClicks=function(e){if(void 0===e)throw new Error("Missing selector");x("click",e,(function(e){var t=j.call(this,e);t.text="input"==t.tag?this.value:(this.textContent||this.innerText||this.innerHTML).replace(/[\s\r\n]+/g," ").trim(),t.href=this.href,i.track("$click",t)}))},i.trackSubmits=function(e){if(void 0===e)throw new Error("Missing selector");x("submit",e,(function(e){var t=j.call(this,e);i.track("$submit",t)}))},i.trackChanges=function(e){if(p("trackChanges is deprecated and will be removed in 0.5.0"),void 0===e)throw new Error("Missing selector");x("change",e,(function(e){var t=j.call(this,e);i.track("$change",t)}))};try{l=JSON.parse(m("ahoy_events")||"[]")}catch(e){}for(var I=0;I<l.length;I++)P(l[I]);return i.start=function(){E(),i.start=function(){}},s=function(){n.startOnReady&&i.start()},"interactive"===document.readyState||"complete"===document.readyState?setTimeout(s,0):document.addEventListener("DOMContentLoaded",s),i}));
